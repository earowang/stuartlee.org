<!DOCTYPE html>
<html>
  <head>
    <title>plyranges</title>
    <meta charset="utf-8">
    <meta name="author" content="Stuart Lee  @_StuartLee" />
    <link href="libs/remark-css/example.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# plyranges
## A fluent interface to Ranges classes
### Stuart Lee<br/> <span class="citation">@_StuartLee</span>
### 2017/11/17

---




# Bioconductor Infrastructure is powerful...

&lt;img src="pkgs.svg" width="250" style="display: block; margin: auto;" /&gt;


```
# IRanges object with 3 ranges and 0 metadata columns:
#           start       end     width
#       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;
#   [1]         1         5         5
#   [2]         2         6         5
#   [3]         3         7         5
```

```
# GRanges object with 3 ranges and 1 metadata column:
#       seqnames    ranges strand |       hello
#          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt;
#   [1]     seq1    [1, 5]      + |           I
#   [2]     seq1    [2, 6]      * |          am
#   [3]     seq1    [3, 7]      - |        data
#   -------
#   seqinfo: 1 sequence from an unspecified genome; no seqlengths
```
---
# but the learning curve can be steep. 

- Object oriented thinking.

- Many, many intermediate classes to keep track of.

- Method discovery.

- Return type consistency.

---
class: inverse, center, middle


## Can most genomic data wrangling tasks can be performed with just _*Ranges_?

---

# Example: restriction by fraction of overlap

![](intersect-example.svg)&lt;!-- --&gt;

### bedtools

```bash
bedtools intersect -a cpg.bed -b exons.bed  -g hg19 -f 0.5 -wo
```

---

### Bioconductor approach


```r
library(GenomicRanges)
library(rtracklayer)
cpg &lt;- import("cpg.bed", genome = "hg19") # GRanges 
exons &lt;- import("exons.bed", genome = "hg19") # GRanges
pairs &lt;- findOverlapPairs(cpg, exons, ignore.strand = TRUE) # Pairs
olap &lt;- pintersect(pairs, ignore.strand = TRUE) # GRanges
keep &lt;- width(olap)/width(first(pairs)) &gt;= 0.5 # logical vector
pairs &lt;- pairs[keep] # Pairs 
mcols(pairs)$overlap_width &lt;- width(olap)[keep] # add colum to Pairs
```

---
# plyranges approach


```r
library(plyranges)
cpg &lt;- read_bed("cpg.bed",genome_info = "hg19")
exons &lt;- read_bed("exons.bed", genome_info = "hg19" )
overlaps &lt;- join_overlap_inner(cpg, exons) %&gt;% 
  filter(width / width.x  &gt;= 0.5) %&gt;%
  mutate(overlap_width = width)
```

---

# Summary
    
_plyranges_ is:

- Declarative and functional.

- **Always** returns a Ranges object.

- Provides a grammar built on top of IRanges/GenomicRanges.

---
# Acknowledgements

* **Michael Lawrence**

* **Di Cook**

* Matt Ritchie

* Charity Law

* Earo Wang

* BiocAsia2017 organising committee

# https://github.com/sa-lee/plyranges
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
